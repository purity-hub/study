@[TOC](目录)
# 重排序
指令中断-->减少中断-->提高性能

```java
a=b+c
d=e-f
```
上面算术运算在装载b和c后，执行add(b,c)会产生停顿，从而导致后面的指令发生停顿，其实可以先执行先加载e-f再加载add(b,c)来减少停顿

**指令重排可以保证串行语义一致，但没有义务保证多线程间的语义也一致**


# 顺序一致性模型与JMM的保证

程序正确同步，那么程序的执行将具有程序一致性

## 顺序一致性模型

特性
- 一个线程中的所有操作必须符合java代码的顺序执行
- 不论线程是否同步，所有线程只能看到一个单一的操作执行顺序，即每个操作必须是原子性的，且立刻对所有线程可见

## JMM
**具体实现方针：在不改变(正确同步的)程序执行结果的前提下尽量为编译期和处理器优化**


# happens-before
只要不改变程序的执行结果，编译器和处理器可以随便优化

JMM提供了happens-before规则，提供了足够强的内存可见性保证

happens-before关系定义：

 1. 如果第一个操作happens-before另一个操作，那么第一个操作的执行结果对另一个操作可见，执行顺序也在它之前
 2. 两个操作存在happens-before关系，并不意味着java平台的具体实现要按照happens-before关系顺序执行



